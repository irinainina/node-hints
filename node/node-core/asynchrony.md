## Асинхронность в Node.js

Асинхронность в Node.js реализуется через
- функции обратного вызова - колбеки
- промисы и async/await функции

#### Функции обратного вызова
Функции обратного вызова или колбеки (callback) - простейший способ написания асинхронного кода в Node.js.

Коллбэк — это обычная функция, которая передаётся, как значение, другой функции. Вызвана она будет только в том случае, когда произойдёт некое событие. 

Например, в JS коллбеками являются всем известные слушатели событий

```js
element.addEventListener('click', () => {
  //пользователь кликнул по элементу
  //теперь что-то произойдёт
})
```

С коллбеками в Node.js мы уже сталкивались, рассматривая неблокирующий ввод/вывод:

```js
fs.readFile('file.md', (err, data) => {
  if (err) throw err;
  console.log(data);
});
```

У метода `fs.readFile()` два параметра: название файла, который необходимо прочитать, и функция обратного вызова - коллбек.  
Есть общее правило для работы с коллбеками в Node.js: первым параметром любой функции обратного вызова указывается объект ошибки. При отсутствии ошибок в этот параметр будет записано значение null. В противном случае в параметр запишется объект ошибки, содержащий её описание и дополнительные сведения о ней. 

Коллбеками удобно пользоваться в простых ситуациях. Но каждый коллбэк — это дополнительный уровень вложенности кода. Если используется несколько вложенных коллбэков, это быстро приводит к значительному усложнению структуры кода, тому, что в программировании называется callback hell - ад из коллбеков.

#### Промисы и async/await функции

Когда модуль fs только создавался, основным способом написания асинхронного кода в Node.js были коллбэки. Но по мере роста популярности промисов, команда Node.js поработала и над их поддержкой в модуле fs.

Создадим асинхронную функцию для чтения файла. Такие функции начинаются с ключевого слова async. С помощью async/await функции можно разрешать промисы, используя await, вместо того чтобы связывать промис с помощью метода .then().

```js
const fs = require('fs').promises;

async function readFile(fileName) {
  try {
    const data = await fs.readFile(fileName);
    console.log(data.toString());
  } catch (err) {
    throw err;
  }
}
readFile('file.md');
```
    
Чтобы ловить ошибки асинхронного чтения файлов, заключаем вызов fs.readFile() в блок try...catch.

Если обнаружена ошибка (если файл не найден или нет прав на чтение), в консоль выведется уведомление об ошибке.

Осталось лишь вызвать функцию, запустив файл с кодом.